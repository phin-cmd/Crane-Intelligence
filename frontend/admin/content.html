<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Management - Crane Intelligence Admin</title>
    <link rel="stylesheet" href="css/admin-dashboard.css">
    <link rel="stylesheet" href="css/dashboard-components.css">
    <link rel="icon" type="image/x-icon" href="../images/logos/crane-intelligence-favicon.ico">
    <script src="../js/notification-system.js"></script>
    <script src="js/admin-notifications.js"></script>
    <style>
        /* Profile Dropdown Styles */
        .admin-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            transition: all 0.2s ease;
            position: relative;
        }

        .admin-profile:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .profile-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #00FF85, #00CC6A);
            color: #0F0F0F;
            font-weight: 700;
            font-size: 16px;
        }

        .avatar-initials {
            font-size: 16px;
            font-weight: 700;
            color: #0F0F0F;
        }

        .profile-info {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .profile-name {
            font-size: 14px;
            font-weight: 600;
            color: #FFFFFF;
            line-height: 1.2;
        }

        .profile-role {
            font-size: 12px;
            color: #B0B0B0;
            line-height: 1.2;
        }

        .profile-dropdown-btn {
            display: flex;
            align-items: center;
            color: #B0B0B0;
            transition: transform 0.2s ease;
        }

        .admin-profile:hover .profile-dropdown-btn {
            transform: translateY(1px);
        }

        .profile-dropdown {
            position: fixed;
            top: 80px;
            right: 20px;
            background: #ffffff;
            border: 2px solid #cccccc;
            border-radius: 8px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            min-width: 200px;
            z-index: 9999;
            display: none;
        }

        .profile-dropdown.show {
            display: block !important;
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            color: #333333 !important;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.2s ease;
            cursor: pointer;
        }

        .dropdown-item svg {
            color: #666666 !important;
            flex-shrink: 0;
        }

        .dropdown-item span {
            color: #333333 !important;
        }

        .dropdown-item:hover {
            background: #f5f5f5;
        }

        .dropdown-divider {
            height: 1px;
            background: #eeeeee;
            margin: 4px 0;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Header -->
        <header class="admin-header">
            <div class="header-left">
                <div class="logo">
                    <img src="../images/logos/crane-intelligence-logo.svg" alt="Crane Intelligence" class="logo-img">
                </div>
                <h1 class="page-title">Content Management</h1>
            </div>
            <div class="header-right">
                <div class="admin-profile" onclick="toggleProfileDropdown()" style="cursor: pointer;">
                    <div class="profile-avatar">
                        <div class="avatar-initials">AU</div>
                    </div>
                    <div class="profile-info">
                        <div class="profile-name">Admin User</div>
                        <div class="profile-role">Administrator</div>
                    </div>
                    <div class="profile-dropdown-btn">
                        <svg width="12" height="8" viewBox="0 0 12 8" fill="none">
                            <path d="M1 1.5L6 6.5L11 1.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                </div>
                
                <!-- Profile Dropdown -->
                <div class="profile-dropdown" id="profileDropdown">
                    <div class="dropdown-item" onclick="navigateToProfile()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>Profile</span>
                    </div>
                    <div class="dropdown-item" onclick="navigateToSettings()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>Settings</span>
                    </div>
                    <div class="dropdown-divider"></div>
                    <div class="dropdown-item" onclick="logout()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <polyline points="16,17 21,12 16,7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <line x1="21" y1="12" x2="9" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>Logout</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Sidebar -->
        <nav class="admin-sidebar">
            <ul class="nav-menu">
                <li><a href="dashboard.html" class="nav-link">Dashboard</a></li>
                <li><a href="users.html" class="nav-link">Users</a></li>
                <li><a href="content.html" class="nav-link active">Content</a></li>
                <li><a href="analytics.html" class="nav-link">Analytics</a></li>
                <li><a href="settings.html" class="nav-link">Settings</a></li>
                <li><a href="security.html" class="nav-link">Security</a></li>
                <li><a href="data.html" class="nav-link">Data</a></li>
                <li><a href="database.html" class="nav-link">Database</a></li>
                <li><a href="admin-users.html" class="nav-link">Admin Users</a></li>
                <li><a href="core-logic.html" class="nav-link">Core Logic</a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="admin-main">
            <div class="content-header">
                <div class="content-actions">
                    <button class="btn btn-primary" id="createContentBtn">
                        <i class="icon">+</i> Create Content
                    </button>
                    <button class="btn btn-secondary" id="uploadMediaBtn">
                        <i class="icon">üìÅ</i> Upload Media
                    </button>
                </div>
                <div class="content-filters">
                    <select id="contentTypeFilter" class="filter-select">
                        <option value="">All Types</option>
                        <option value="article">Article</option>
                        <option value="blog_post">Blog Post</option>
                        <option value="news">News</option>
                        <option value="resource">Resource</option>
                    </select>
                    <select id="statusFilter" class="filter-select">
                        <option value="">All Status</option>
                        <option value="draft">Draft</option>
                        <option value="published">Published</option>
                        <option value="archived">Archived</option>
                    </select>
                    <input type="text" id="searchInput" placeholder="Search content..." class="search-input">
                </div>
            </div>

            <!-- Content Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üìù</div>
                    <div class="stat-content">
                        <div class="stat-value" id="totalContent">0</div>
                        <div class="stat-label">Total Content</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üì∞</div>
                    <div class="stat-content">
                        <div class="stat-value" id="publishedContent">0</div>
                        <div class="stat-label">Published</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìã</div>
                    <div class="stat-content">
                        <div class="stat-value" id="draftContent">0</div>
                        <div class="stat-label">Drafts</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üëÅÔ∏è</div>
                    <div class="stat-content">
                        <div class="stat-value" id="totalViews">0</div>
                        <div class="stat-label">Total Views</div>
                    </div>
                </div>
            </div>

            <!-- Content Table -->
            <div class="content-table-container">
                <table class="data-table" id="contentTable">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="select-all-content" onchange="toggleSelectAllContent(this.checked)"></th>
                            <th data-sort="title" style="cursor: pointer;">Title <span class="sort-indicator"></span></th>
                            <th data-sort="type" style="cursor: pointer;">Type <span class="sort-indicator"></span></th>
                            <th data-sort="status" style="cursor: pointer;">Status <span class="sort-indicator"></span></th>
                            <th data-sort="author" style="cursor: pointer;">Author <span class="sort-indicator"></span></th>
                            <th data-sort="views" style="cursor: pointer;">Views <span class="sort-indicator"></span></th>
                            <th data-sort="created_at" style="cursor: pointer;">Created <span class="sort-indicator"></span></th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="contentTableBody">
                        <!-- Content will be loaded here -->
                    </tbody>
                </table>
            </div>

            <!-- Bulk Actions -->
            <div class="bulk-actions" id="bulkActions" style="display: none;">
                <div class="bulk-actions-info">
                    <span id="selectedCount">0</span> items selected
                </div>
                <div class="bulk-actions-buttons">
                    <button class="btn btn-sm btn-primary" onclick="bulkPublish()">Publish</button>
                    <button class="btn btn-sm btn-warning" onclick="bulkDraft()">Move to Draft</button>
                    <button class="btn btn-sm btn-secondary" onclick="bulkDuplicate()">Duplicate</button>
                    <button class="btn btn-sm btn-danger" onclick="bulkDelete()">Delete</button>
                </div>
            </div>

            <!-- Pagination -->
            <div class="pagination" id="contentPagination">
                <!-- Pagination will be loaded here -->
            </div>
        </main>
    </div>

    <!-- Content Modal -->
    <div class="modal" id="contentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Create Content</h3>
                <button class="modal-close" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="contentForm">
                    <div class="form-group">
                        <label for="contentTitle">Title</label>
                        <input type="text" id="contentTitle" name="title" required>
                    </div>
                    <div class="form-group">
                        <label for="contentType">Type</label>
                        <select id="contentType" name="content_type">
                            <option value="article">Article</option>
                            <option value="blog_post">Blog Post</option>
                            <option value="news">News</option>
                            <option value="resource">Resource</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="contentBody">Content</label>
                        <textarea id="contentBody" name="content" rows="10" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="contentExcerpt">Excerpt</label>
                        <textarea id="contentExcerpt" name="excerpt" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="contentStatus">Status</label>
                        <select id="contentStatus" name="status">
                            <option value="draft">Draft</option>
                            <option value="published">Published</option>
                            <option value="archived">Archived</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelContent">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveContent">Save Content</button>
            </div>
        </div>
    </div>

    <script src="js/admin-api.js"></script>
    <script src="js/content.js"></script>
    <script>
        // Profile Dropdown Functions
        function toggleProfileDropdown() {
            const dropdown = document.getElementById('profileDropdown');
            dropdown.classList.toggle('show');
        }

        function navigateToProfile() {
            window.location.href = 'profile.html';
        }

        function navigateToSettings() {
            window.location.href = 'settings.html';
        }

        function logout() {
            // Clear any stored authentication data
            localStorage.removeItem('authToken');
            localStorage.removeItem('userData');
            
            // Redirect to login page
            window.location.href = 'login.html';
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('profileDropdown');
            const profile = document.querySelector('.admin-profile');
            
            if (!profile.contains(event.target)) {
                dropdown.classList.remove('show');
            }
        });

        // Advanced content management functionality with real-time database operations
        let contentItems = [];
        let filteredContent = [];
        let selectedContent = new Set();
        let currentFilters = {
            search: '',
            type: '',
            status: ''
        };
        let currentSort = {
            field: 'created_at',
            direction: 'desc'
        };
        let currentPage = 1;
        let itemsPerPage = 10;

        document.addEventListener('DOMContentLoaded', function() {
            console.log('Content management page loaded, initializing...');
            loadContent();
            setupEventListeners();
            setupTableSorting();
            setupBulkActions();
        });

        async function loadContent() {
            let loadingId;
            try {
                console.log('Loading content from database...');
                loadingId = notificationSystem.showLoading('Loading content...');
                
                const response = await fetch('http://localhost:8003/api/v1/admin/content', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('access_token') || ''}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                contentItems = data.content || data.items || [];
                console.log('Content loaded from database:', contentItems.length);
                
                // Apply current filters
                applyFilters();
                renderContent();
                updateStats();
                
                notificationSystem.hideLoading(loadingId);
                notificationSystem.showSuccess('Content Loaded', `Successfully loaded ${contentItems.length} content items`);
                
            } catch (error) {
                console.error('Error loading content:', error);
                notificationSystem.hideLoading(loadingId);
                
                // Fallback to mock data for demonstration
            contentItems = [
                {
                    id: 1,
                    title: 'Getting Started with Crane Intelligence',
                    type: 'article',
                    status: 'published',
                    author: 'John Doe',
                        created_at: '2024-01-15T10:30:00Z',
                    views: 1250,
                        category: 'Tutorial',
                        content: 'This is a comprehensive guide to getting started with Crane Intelligence...',
                        tags: ['tutorial', 'beginner', 'guide']
                },
                {
                    id: 2,
                    title: 'Advanced Analytics Features',
                    type: 'blog_post',
                    status: 'draft',
                    author: 'Jane Smith',
                        created_at: '2024-01-20T14:15:00Z',
                    views: 0,
                        category: 'Features',
                        content: 'Learn about the advanced analytics features available in Crane Intelligence...',
                        tags: ['analytics', 'features', 'advanced']
                },
                {
                    id: 3,
                    title: 'Company News: Q1 Updates',
                    type: 'news',
                    status: 'published',
                    author: 'Mike Johnson',
                        created_at: '2024-01-25T09:45:00Z',
                    views: 890,
                        category: 'News',
                        content: 'Here are the latest updates from Q1 2024...',
                        tags: ['news', 'updates', 'company']
                },
                {
                    id: 4,
                    title: 'User Guide: Database Management',
                    type: 'resource',
                    status: 'published',
                    author: 'Sarah Wilson',
                        created_at: '2024-02-01T16:20:00Z',
                    views: 2100,
                        category: 'Documentation',
                        content: 'Complete guide to managing your database in Crane Intelligence...',
                        tags: ['documentation', 'database', 'guide']
                    },
                    {
                        id: 5,
                        title: 'Best Practices for Crane Valuation',
                        type: 'article',
                        status: 'published',
                        author: 'David Brown',
                        created_at: '2024-02-05T11:30:00Z',
                        views: 1750,
                        category: 'Best Practices',
                        content: 'Learn the best practices for accurate crane valuation...',
                        tags: ['valuation', 'best-practices', 'crane']
                    }
                ];
                
                applyFilters();
                renderContent();
            updateStats();
                notificationSystem.showWarning('Using Demo Data', 'Could not connect to database. Using demo data for demonstration.');
            }
        }

        function setupEventListeners() {
            // Create Content Button
            const createBtn = document.getElementById('createContentBtn');
            if (createBtn) {
                createBtn.addEventListener('click', createNewContent);
            }

            // Upload Media Button
            const uploadBtn = document.getElementById('uploadMediaBtn');
            if (uploadBtn) {
                uploadBtn.addEventListener('click', uploadMedia);
            }

            // Search Input
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', function(e) {
                    currentFilters.search = e.target.value.toLowerCase();
                    applyFilters();
                });
            }

            // Type Filter
            const typeFilter = document.getElementById('contentTypeFilter');
            if (typeFilter) {
                typeFilter.addEventListener('change', function(e) {
                    currentFilters.type = e.target.value;
                    applyFilters();
                });
            }

            // Status Filter
            const statusFilter = document.getElementById('statusFilter');
            if (statusFilter) {
                statusFilter.addEventListener('change', function(e) {
                    currentFilters.status = e.target.value;
                    applyFilters();
                });
            }
        }

        function setupTableSorting() {
            const tableHeaders = document.querySelectorAll('#contentTable th[data-sort]');
            tableHeaders.forEach(header => {
                header.style.cursor = 'pointer';
                header.addEventListener('click', function() {
                    const field = this.dataset.sort;
                    const currentDirection = currentSort.field === field ? currentSort.direction : 'asc';
                    const newDirection = currentDirection === 'asc' ? 'desc' : 'asc';
                    
                    currentSort = { field, direction: newDirection };
                    sortContent();
                    updateSortIndicators();
                });
            });
        }

        function setupBulkActions() {
            // Select all checkbox
            const selectAllCheckbox = document.getElementById('select-all-content');
            if (selectAllCheckbox) {
                selectAllCheckbox.addEventListener('change', function(e) {
                    const checkboxes = document.querySelectorAll('.content-checkbox');
                    checkboxes.forEach(cb => {
                        cb.checked = e.target.checked;
                        const contentId = parseInt(cb.dataset.contentId);
                        if (e.target.checked) {
                            selectedContent.add(contentId);
                        } else {
                            selectedContent.delete(contentId);
                        }
                    });
                    updateBulkActions();
                });
            }
        }

        function applyFilters() {
            filteredContent = contentItems.filter(item => {
                const matchesSearch = !currentFilters.search || 
                    item.title.toLowerCase().includes(currentFilters.search) ||
                    item.author.toLowerCase().includes(currentFilters.search) ||
                    item.category.toLowerCase().includes(currentFilters.search) ||
                    (item.tags && item.tags.some(tag => tag.toLowerCase().includes(currentFilters.search)));
                
                const matchesType = !currentFilters.type || item.type === currentFilters.type;
                const matchesStatus = !currentFilters.status || item.status === currentFilters.status;
                
                return matchesSearch && matchesType && matchesStatus;
            });
            
            sortContent();
            renderContent();
        }

        function sortContent() {
            const contentToSort = filteredContent.length > 0 ? filteredContent : contentItems;
            
            contentToSort.sort((a, b) => {
                let aValue = a[currentSort.field];
                let bValue = b[currentSort.field];
                
                // Handle special cases
                if (currentSort.field === 'created_at') {
                    aValue = new Date(a.created_at || 0);
                    bValue = new Date(b.created_at || 0);
                } else if (currentSort.field === 'views') {
                    aValue = parseInt(a.views || 0);
                    bValue = parseInt(b.views || 0);
                }
                
                if (aValue < bValue) return currentSort.direction === 'asc' ? -1 : 1;
                if (aValue > bValue) return currentSort.direction === 'asc' ? 1 : -1;
                return 0;
            });
            
            if (filteredContent.length > 0) {
                filteredContent = contentToSort;
            } else {
                contentItems = contentToSort;
            }
        }

        function updateSortIndicators() {
            const headers = document.querySelectorAll('#contentTable th[data-sort]');
            headers.forEach(header => {
                const field = header.dataset.sort;
                const isActive = currentSort.field === field;
                const direction = isActive ? currentSort.direction : '';
                
                // Remove existing indicators
                header.querySelector('.sort-indicator')?.remove();
                
                if (isActive) {
                    const indicator = document.createElement('span');
                    indicator.className = 'sort-indicator';
                    indicator.innerHTML = direction === 'asc' ? '‚Üë' : '‚Üì';
                    indicator.style.marginLeft = '5px';
                    indicator.style.color = '#00FF85';
                    header.appendChild(indicator);
                }
            });
        }

        function updateStats() {
            const totalContent = document.getElementById('totalContent');
            const publishedContent = document.getElementById('publishedContent');
            const draftContent = document.getElementById('draftContent');
            const totalViews = document.getElementById('totalViews');

            if (totalContent) totalContent.textContent = contentItems.length;
            if (publishedContent) publishedContent.textContent = contentItems.filter(item => item.status === 'published').length;
            if (draftContent) draftContent.textContent = contentItems.filter(item => item.status === 'draft').length;
            if (totalViews) {
                const totalViewsCount = contentItems.reduce((sum, item) => sum + (parseInt(item.views) || 0), 0);
                totalViews.textContent = totalViewsCount.toLocaleString();
            }
        }

        function renderContent() {
            const tbody = document.getElementById('contentTableBody');
            if (!tbody) return;

            // Use filtered content if available, otherwise use all content
            const contentToRender = filteredContent.length > 0 ? filteredContent : contentItems;

            tbody.innerHTML = contentToRender.map(item => {
                const isSelected = selectedContent.has(item.id);
                const createdDate = formatDate(item.created_at);
                const statusClass = item.status === 'published' ? 'status-published' : 
                                  item.status === 'draft' ? 'status-draft' : 'status-archived';
                
                return `
                    <tr class="content-row ${isSelected ? 'selected' : ''}" data-content-id="${item.id}">
                        <td>
                            <input type="checkbox" class="content-checkbox" data-content-id="${item.id}" 
                                   onchange="toggleContentSelection(${item.id}, this.checked)" ${isSelected ? 'checked' : ''}>
                        </td>
                        <td>
                            <div class="content-title-cell">
                                <div class="content-title">${item.title}</div>
                        <div class="content-category">${item.category}</div>
                    </div>
                        </td>
                        <td>
                            <span class="content-type-badge type-${item.type}">${formatContentType(item.type)}</span>
                        </td>
                        <td>
                            <span class="status-badge ${statusClass}">${item.status.toUpperCase()}</span>
                        </td>
                        <td>${item.author}</td>
                        <td>${item.views.toLocaleString()}</td>
                        <td>${createdDate}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-sm btn-primary" onclick="editContent(${item.id})" title="Edit">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg>
                                </button>
                                <button class="btn btn-sm btn-secondary" onclick="viewContent(${item.id})" title="View">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                </button>
                                <button class="btn btn-sm btn-warning" onclick="duplicateContent(${item.id})" title="Duplicate">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                    </svg>
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="deleteContent(${item.id})" title="Delete">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="3,6 5,6 21,6"></polyline>
                                        <path d="M19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"></path>
                                    </svg>
                                </button>
                    </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            updateBulkActions();
        }

        function formatContentType(type) {
            const typeMap = {
                'article': 'Article',
                'blog_post': 'Blog Post',
                'news': 'News',
                'resource': 'Resource'
            };
            return typeMap[type] || type.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
        }

        // Content CRUD Operations
        async function createNewContent() {
            let loadingId;
            try {
                loadingId = notificationSystem.showLoading('Creating new content...');
                
                const newContent = {
                    title: 'New Content Item',
                    type: 'article',
                    status: 'draft',
                    author: 'Current User',
                    content: 'Enter your content here...',
                    category: 'General',
                    tags: []
                };
                
                const response = await fetch('http://localhost:8003/api/v1/admin/content', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('access_token') || ''}`
                    },
                    body: JSON.stringify(newContent)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                const createdContent = data.content || data;
                
                // Add to local array
                contentItems.unshift(createdContent);
                
                notificationSystem.hideLoading(loadingId);
                adminNotifications.contentSaved('New Content');
                
                // Refresh display
                applyFilters();
                updateStats();
                
            } catch (error) {
                notificationSystem.hideLoading(loadingId);
                adminNotifications.handleApiError(error, 'Create Content');
            }
        }

        async function editContent(contentId) {
            try {
            const content = contentItems.find(item => item.id === contentId);
                if (!content) {
                    notificationSystem.showError('Content Not Found', 'The selected content item was not found');
                    return;
                }
                
                let loadingId;
                loadingId = notificationSystem.showLoading('Opening content editor...');
                
                // In a real app, this would open a content editor modal
                setTimeout(() => {
                    notificationSystem.hideLoading(loadingId);
                    notificationSystem.showInfo('Edit Content', `Editing: ${content.title}. Content editor would open here.`);
            }, 1000);
                
            } catch (error) {
                notificationSystem.hideLoading(loadingId);
                adminNotifications.handleApiError(error, 'Edit Content');
            }
        }

        async function viewContent(contentId) {
            try {
            const content = contentItems.find(item => item.id === contentId);
                if (!content) {
                    notificationSystem.showError('Content Not Found', 'The selected content item was not found');
                    return;
                }
                
                let loadingId;
                loadingId = notificationSystem.showLoading('Loading content viewer...');
                
                // In a real app, this would open a content viewer
                setTimeout(() => {
                    notificationSystem.hideLoading(loadingId);
                    notificationSystem.showInfo('View Content', `Viewing: ${content.title}. Content viewer would open here.`);
                }, 1000);
                
            } catch (error) {
                notificationSystem.hideLoading(loadingId);
                adminNotifications.handleApiError(error, 'View Content');
            }
        }

        async function duplicateContent(contentId) {
            try {
                const originalContent = contentItems.find(item => item.id === contentId);
                if (!originalContent) {
                    notificationSystem.showError('Content Not Found', 'The selected content item was not found');
                    return;
                }
                
                let loadingId;
                loadingId = notificationSystem.showLoading('Duplicating content...');
                
                const duplicatedContent = {
                    ...originalContent,
                    title: originalContent.title + ' (Copy)',
                    status: 'draft',
                    created_at: new Date().toISOString(),
                    views: 0
                };
                
                const response = await fetch('http://localhost:8003/api/v1/admin/content', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('access_token') || ''}`
                    },
                    body: JSON.stringify(duplicatedContent)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                const createdContent = data.content || data;
                
                // Add to local array
                contentItems.unshift(createdContent);
                
                notificationSystem.hideLoading(loadingId);
                adminNotifications.contentSaved('Content Duplicate');
                
                // Refresh display
                applyFilters();
                updateStats();
                
            } catch (error) {
                notificationSystem.hideLoading(loadingId);
                adminNotifications.handleApiError(error, 'Duplicate Content');
            }
        }

        async function deleteContent(contentId) {
            try {
                const confirmed = await notificationSystem.confirmDangerous(
                    'Delete Content',
                    'Are you sure you want to delete this content item? This action cannot be undone.',
                    { confirmText: 'Delete Content' }
                );
                
                if (!confirmed) return;
                
                let loadingId;
                loadingId = notificationSystem.showLoading('Deleting content...');
                
                const response = await fetch(`http://localhost:8003/api/v1/admin/content/${contentId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('access_token') || ''}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                // Remove from local array
                contentItems = contentItems.filter(item => item.id !== contentId);
                selectedContent.delete(contentId);
                
                notificationSystem.hideLoading(loadingId);
                adminNotifications.contentDeleted('Content Item');
                
                // Refresh display
                applyFilters();
                updateStats();
                
            } catch (error) {
                notificationSystem.hideLoading(loadingId);
                adminNotifications.handleApiError(error, 'Delete Content');
            }
        }

        // Bulk Operations
        async function bulkPublish() {
            if (selectedContent.size === 0) {
                notificationSystem.showError('No Selection', 'Please select content items first');
                return;
            }
            
            const confirmed = await notificationSystem.confirm(
                'Publish Content',
                `Are you sure you want to publish ${selectedContent.size} content item(s)?`,
                { confirmText: 'Publish', type: 'primary' }
            );
            
            if (!confirmed) return;

            let loadingId;
            loadingId = notificationSystem.showLoading('Publishing content...');
            
            try {
                const contentIds = Array.from(selectedContent);
                
                const response = await fetch('http://localhost:8003/api/v1/admin/content/bulk-publish', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('access_token') || ''}`
                    },
                    body: JSON.stringify({ content_ids: contentIds })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                // Update local data
                contentItems.forEach(item => {
                    if (selectedContent.has(item.id)) {
                        item.status = 'published';
                    }
                });
                
                notificationSystem.hideLoading(loadingId);
                adminNotifications.contentPublished(`${selectedContent.size} Content Items`);
                
                selectedContent.clear();
                applyFilters();
                
            } catch (error) {
                notificationSystem.hideLoading(loadingId);
                adminNotifications.handleApiError(error, 'Bulk Publish');
            }
        }

        async function bulkDraft() {
            if (selectedContent.size === 0) {
                notificationSystem.showError('No Selection', 'Please select content items first');
                return;
            }
            
            const confirmed = await notificationSystem.confirm(
                'Move to Draft',
                `Are you sure you want to move ${selectedContent.size} content item(s) to draft?`,
                { confirmText: 'Move to Draft', type: 'warning' }
            );
            
            if (!confirmed) return;
            
            let loadingId;
            loadingId = notificationSystem.showLoading('Moving to draft...');
            
            try {
                const contentIds = Array.from(selectedContent);
                
                const response = await fetch('http://localhost:8003/api/v1/admin/content/bulk-draft', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('access_token') || ''}`
                    },
                    body: JSON.stringify({ content_ids: contentIds })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                // Update local data
                contentItems.forEach(item => {
                    if (selectedContent.has(item.id)) {
                        item.status = 'draft';
                    }
                });
                
                notificationSystem.hideLoading(loadingId);
                adminNotifications.contentSaved(`${selectedContent.size} Content Items`);
                
                selectedContent.clear();
                applyFilters();
                
            } catch (error) {
                notificationSystem.hideLoading(loadingId);
                adminNotifications.handleApiError(error, 'Bulk Draft');
            }
        }

        async function bulkDuplicate() {
            if (selectedContent.size === 0) {
                notificationSystem.showError('No Selection', 'Please select content items first');
                return;
            }
            
            const confirmed = await notificationSystem.confirm(
                'Duplicate Content',
                `Are you sure you want to duplicate ${selectedContent.size} content item(s)?`,
                { confirmText: 'Duplicate', type: 'primary' }
            );
            
            if (!confirmed) return;
            
            let loadingId;
            loadingId = notificationSystem.showLoading('Duplicating content...');
            
            try {
                const contentIds = Array.from(selectedContent);
                const duplicatedItems = [];
                
                for (const contentId of contentIds) {
                    const originalContent = contentItems.find(item => item.id === contentId);
                    if (originalContent) {
                        const duplicatedContent = {
                            ...originalContent,
                            title: originalContent.title + ' (Copy)',
                            status: 'draft',
                            created_at: new Date().toISOString(),
                            views: 0
                        };
                        
                        const response = await fetch('http://localhost:8003/api/v1/admin/content', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${localStorage.getItem('access_token') || ''}`
                            },
                            body: JSON.stringify(duplicatedContent)
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            duplicatedItems.push(data.content || data);
                        }
                    }
                }
                
                // Add to local array
                contentItems.unshift(...duplicatedItems);
                
                notificationSystem.hideLoading(loadingId);
                adminNotifications.contentSaved(`${duplicatedItems.length} Content Duplicates`);
                
                selectedContent.clear();
                applyFilters();
                updateStats();
                
            } catch (error) {
                notificationSystem.hideLoading(loadingId);
                adminNotifications.handleApiError(error, 'Bulk Duplicate');
            }
        }

        async function bulkDelete() {
            if (selectedContent.size === 0) {
                notificationSystem.showError('No Selection', 'Please select content items first');
                return;
            }
            
            const confirmed = await notificationSystem.confirmDangerous(
                'Delete Content',
                `Are you sure you want to delete ${selectedContent.size} content item(s)? This action cannot be undone.`,
                { confirmText: 'Delete Content' }
            );
            
            if (!confirmed) return;
            
            let loadingId;
            loadingId = notificationSystem.showLoading('Deleting content...');
            
            try {
                const contentIds = Array.from(selectedContent);
                
                const response = await fetch('http://localhost:8003/api/v1/admin/content/bulk-delete', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('access_token') || ''}`
                    },
                    body: JSON.stringify({ content_ids: contentIds })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                // Remove from local array
                contentItems = contentItems.filter(item => !selectedContent.has(item.id));
                
                notificationSystem.hideLoading(loadingId);
                adminNotifications.contentDeleted(`${selectedContent.size} Content Items`);
                
                selectedContent.clear();
                applyFilters();
                updateStats();
                
            } catch (error) {
                notificationSystem.hideLoading(loadingId);
                adminNotifications.handleApiError(error, 'Bulk Delete');
            }
        }

        async function uploadMedia() {
            try {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*,video/*,audio/*,.pdf,.doc,.docx';
                input.multiple = true;
                
                input.onchange = async function(e) {
                    const files = Array.from(e.target.files);
                    if (files.length === 0) return;
                    
                    let loadingId;
                    loadingId = notificationSystem.showLoading(`Uploading ${files.length} file(s)...`);
                    
                    try {
                        const formData = new FormData();
                        files.forEach(file => {
                            formData.append('files', file);
                        });
                        
                        const response = await fetch('http://localhost:8003/api/v1/admin/media/upload', {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('access_token') || ''}`
                            },
                            body: formData
                        });
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                        
                        const data = await response.json();
                        
                        notificationSystem.hideLoading(loadingId);
                        adminNotifications.mediaUploaded(`${files.length} file(s)`);
                        
                    } catch (error) {
                        notificationSystem.hideLoading(loadingId);
                        adminNotifications.handleApiError(error, 'Media Upload');
                    }
                };
                
                input.click();
                
            } catch (error) {
                adminNotifications.handleApiError(error, 'Media Upload');
            }
        }

        function toggleContentSelection(contentId, checked) {
            if (checked) {
                selectedContent.add(contentId);
            } else {
                selectedContent.delete(contentId);
            }
            updateBulkActions();
        }

        function updateBulkActions() {
            const bulkActions = document.getElementById('bulkActions');
            const selectedCount = document.getElementById('selectedCount');
            
            if (bulkActions) {
                bulkActions.style.display = selectedContent.size > 0 ? 'flex' : 'none';
            }
            
            if (selectedCount) {
                selectedCount.textContent = selectedContent.size;
            }
        }

        function toggleSelectAllContent(checked) {
            const checkboxes = document.querySelectorAll('.content-checkbox');
            checkboxes.forEach(cb => {
                cb.checked = checked;
                const contentId = parseInt(cb.dataset.contentId);
                if (checked) {
                    selectedContent.add(contentId);
                } else {
                    selectedContent.delete(contentId);
                }
            });
            updateBulkActions();
        }

        // Legacy notification function for compatibility
        function showNotification(message, type = 'info') {
            const title = type.charAt(0).toUpperCase() + type.slice(1);
            switch (type) {
                case 'success':
                    notificationSystem.showSuccess(title, message);
                    break;
                case 'error':
                    notificationSystem.showError(title, message);
                    break;
                case 'warning':
                    notificationSystem.showWarning(title, message);
                    break;
                default:
                    notificationSystem.showInfo(title, message);
            }
        }

        // Add CSS styles for new elements
        const style = document.createElement('style');
        style.textContent = `
            .content-row.selected {
                background-color: rgba(0, 255, 133, 0.1);
                border-left: 3px solid #00FF85;
            }
            
            .content-title-cell {
                display: flex;
                flex-direction: column;
                gap: 4px;
            }
            
            .content-title {
                font-weight: 600;
                color: #FFFFFF;
                font-size: 14px;
            }
            
            .content-category {
                font-size: 12px;
                color: #B0B0B0;
            }
            
            .content-type-badge {
                padding: 4px 8px;
                border-radius: 4px;
                font-size: 12px;
                font-weight: 500;
                text-transform: uppercase;
            }
            
            .type-article { background: #007BFF; color: white; }
            .type-blog_post { background: #28A745; color: white; }
            .type-news { background: #FFC107; color: #000; }
            .type-resource { background: #6F42C1; color: white; }
            
            .status-badge {
                padding: 4px 8px;
                border-radius: 4px;
                font-size: 12px;
                font-weight: 500;
                text-transform: uppercase;
            }
            
            .status-published { background: #28A745; color: white; }
            .status-draft { background: #FFC107; color: #000; }
            .status-archived { background: #6C757D; color: white; }
            
            .action-buttons {
                display: flex;
                gap: 4px;
                align-items: center;
            }
            
            .action-buttons .btn {
                padding: 6px;
                min-width: 32px;
                height: 32px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .bulk-actions {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 12px 20px;
                background: #2A2A2A;
                border: 1px solid #333333;
                border-radius: 6px;
                margin: 20px 0;
            }
            
            .bulk-actions-info {
                color: #FFFFFF;
                font-weight: 500;
            }
            
            .bulk-actions-buttons {
                display: flex;
                gap: 8px;
            }
            
            .sort-indicator {
                margin-left: 5px;
                color: #00FF85;
                font-weight: bold;
            }
            
            .content-checkbox {
                margin: 0;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
