<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Dropdown Test</title>
    <script src="https://craneintelligence.tech/js/unified-auth-utils.js" defer></script>
    <style>
        body {
            background: #0F0F0F;
            color: white;
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        header {
            background: #1A1A1A;
            padding: 20px;
            position: relative;
        }
        .user-profile-wrapper {
            position: absolute;
            right: 32px;
            top: 50%;
            transform: translateY(-50%);
        }
        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            position: relative;
        }
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #00D9FF;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .user-info {
            display: flex;
            flex-direction: column;
        }
        .user-name {
            font-size: 14px;
            font-weight: 500;
        }
        .user-role {
            font-size: 12px;
            color: #888;
        }
        .dropdown-arrow {
            font-size: 12px;
        }
        .user-dropdown {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: #1A1A1A;
            border: 1px solid #333333;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            min-width: 200px;
            z-index: 1001;
            display: none;
            margin-top: 4px;
        }
        .user-dropdown.show {
            display: block;
        }
        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            color: #FFFFFF;
            text-decoration: none;
            transition: background-color 0.2s;
        }
        .dropdown-item:hover {
            background-color: #2A2A2A;
        }
        .dropdown-divider {
            height: 1px;
            background: #333333;
            margin: 4px 0;
        }
    </style>
</head>
<body>
    <h1>Dashboard Dropdown Test (Using unified-auth-utils.js)</h1>
    <p>This page tests the dropdown with the same structure as dashboard.html</p>
    
    <header>
        <div style="padding: 20px 0;">Dashboard Header</div>
        <div class="user-profile-wrapper">
            <div class="user-profile" id="userProfile" onclick="toggleDropdown(event)">
                <div class="user-avatar" id="userAvatar">
                    <span id="userInitials">JD</span>
                </div>
                <div class="user-info">
                    <div class="user-name" id="userDisplayName">John Doe</div>
                    <div class="user-role" id="userRole">Premium User</div>
                </div>
                <span class="dropdown-arrow">‚ñº</span>
            </div>
            <div class="user-dropdown" id="userDropdown">
                <a href="dashboard.html" class="dropdown-item">
                    <span class="dropdown-icon">üìä</span>
                    Dashboard
                </a>
                <a href="valuation_terminal.html" class="dropdown-item">
                    <span class="dropdown-icon">‚ö°</span>
                    Valuation Terminal
                </a>
                <a href="account-settings.html" class="dropdown-item">
                    <span class="dropdown-icon">‚öôÔ∏è</span>
                    Account Settings
                </a>
                <div class="dropdown-divider"></div>
                <a href="#" class="dropdown-item" onclick="alert('Logout clicked'); return false;">
                    <span class="dropdown-icon">üö™</span>
                    Logout
                </a>
            </div>
        </div>
    </header>
    
    <div style="margin-top: 40px;">
        <h2>Test Instructions:</h2>
        <ol>
            <li>Click on the user profile (top right)</li>
            <li>Dropdown should open showing menu items</li>
            <li>Click on user profile again - dropdown should close</li>
            <li>Open dropdown, then click outside - dropdown should close</li>
            <li>Open dropdown, click on a menu item - should navigate/alert</li>
        </ol>
    </div>

    <script>
        // Fallback if unified-auth-utils.js doesn't load
        window.addEventListener('load', function() {
            setTimeout(function() {
                if (!window.toggleDropdown) {
                    console.log('unified-auth-utils.js not loaded, using fallback');
                    window.toggleDropdown = function(event) {
                        if (event) {
                            event.stopPropagation();
                        }
                        const dropdown = document.getElementById('userDropdown');
                        if (dropdown) {
                            dropdown.classList.toggle('show');
                            console.log('Dropdown toggled (fallback), show:', dropdown.classList.contains('show'));
                        }
                    };
                    
                    document.addEventListener('click', function(event) {
                        const wrapper = document.querySelector('.user-profile-wrapper');
                        const dropdown = document.getElementById('userDropdown');
                        
                        if (dropdown && wrapper && !wrapper.contains(event.target)) {
                            dropdown.classList.remove('show');
                            console.log('Clicked outside, dropdown closed (fallback)');
                        }
                    });
                } else {
                    console.log('unified-auth-utils.js loaded successfully');
                }
            }, 1000);
        });
    </script>
</body>
</html>

