<!-- ===== CRANE INTELLIGENCE - UNIFIED VALUATION FORM COMPONENT ===== -->
<!-- Centralized crane valuation form for use across all pages -->

<div class="valuation-form-container" id="valuationFormContainer">
    <form id="valuationForm" class="valuation-form">
        <div class="form-section">
            <h3 class="form-section-title">Equipment Information</h3>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="manufacturer" class="form-label">Manufacturer *</label>
                    <select id="manufacturer" name="manufacturer" class="form-select" required>
                        <option value="">Select Manufacturer</option>
                        <option value="Liebherr">Liebherr</option>
                        <option value="Grove">Grove</option>
                        <option value="Manitowoc">Manitowoc</option>
                        <option value="Terex">Terex</option>
                        <option value="XCMG">XCMG</option>
                        <option value="Sany">Sany</option>
                        <option value="Zoomlion">Zoomlion</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="model" class="form-label">Model *</label>
                    <input 
                        type="text" 
                        id="model" 
                        name="model" 
                        class="form-input" 
                        placeholder="Enter model number"
                        required
                    >
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="year" class="form-label">Year *</label>
                    <input 
                        type="number" 
                        id="year" 
                        name="year" 
                        class="form-input" 
                        placeholder="e.g., 2020"
                        min="1950"
                        max="2025"
                        required
                    >
                </div>
                
                <div class="form-group">
                    <label for="capacity" class="form-label">Capacity (tons) *</label>
                    <input 
                        type="number" 
                        id="capacity" 
                        name="capacity" 
                        class="form-input" 
                        placeholder="e.g., 50"
                        min="1"
                        required
                    >
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="hours" class="form-label">Operating Hours</label>
                    <input 
                        type="number" 
                        id="hours" 
                        name="hours" 
                        class="form-input" 
                        placeholder="e.g., 5000"
                        min="0"
                    >
                </div>
                
                <div class="form-group">
                    <label for="condition" class="form-label">Condition *</label>
                    <select id="condition" name="condition" class="form-select" required>
                        <option value="">Select Condition</option>
                        <option value="excellent">Excellent</option>
                        <option value="good">Good</option>
                        <option value="fair">Fair</option>
                        <option value="poor">Poor</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="form-section">
            <h3 class="form-section-title">Location & Market</h3>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="region" class="form-label">Region *</label>
                    <select id="region" name="region" class="form-select" required>
                        <option value="">Select Region</option>
                        <option value="north_america">North America</option>
                        <option value="europe">Europe</option>
                        <option value="asia_pacific">Asia Pacific</option>
                        <option value="middle_east">Middle East</option>
                        <option value="south_america">South America</option>
                        <option value="africa">Africa</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="country" class="form-label">Country</label>
                    <input 
                        type="text" 
                        id="country" 
                        name="country" 
                        class="form-input" 
                        placeholder="e.g., United States"
                    >
                </div>
            </div>
        </div>
        
        <div class="form-section">
            <h3 class="form-section-title">Additional Information</h3>
            
            <div class="form-group">
                <label for="notes" class="form-label">Additional Notes</label>
                <textarea 
                    id="notes" 
                    name="notes" 
                    class="form-textarea" 
                    placeholder="Any additional information about the equipment..."
                    rows="4"
                ></textarea>
            </div>
        </div>
        
        <div class="form-actions">
            <button type="button" class="btn-secondary" onclick="resetValuationForm()">Reset</button>
            <button type="submit" class="btn-primary" id="valuationSubmitBtn">
                Calculate Valuation
            </button>
        </div>
        
        <div class="loading" id="valuationLoading" style="display: none;">
            <div class="loading-spinner"></div>
            <span>Calculating valuation...</span>
        </div>
    </form>
</div>

<style>
/* Valuation Form Styles - Centralized */
.valuation-form-container {
    max-width: 900px;
    margin: 0 auto;
    padding: 32px;
}

.valuation-form {
    background: #1A1A1A;
    border: 1px solid #333333;
    border-radius: 12px;
    padding: 32px;
}

.form-section {
    margin-bottom: 32px;
    padding-bottom: 32px;
    border-bottom: 1px solid #333333;
}

.form-section:last-of-type {
    border-bottom: none;
}

.form-section-title {
    font-size: 18px;
    font-weight: 600;
    color: #00FF85;
    margin-bottom: 24px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
}

.form-group {
    margin-bottom: 20px;
}

.form-label {
    display: block;
    font-size: 12px;
    font-weight: 600;
    color: #00FF85;
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.form-input,
.form-select,
.form-textarea {
    width: 100%;
    background: #2A2A2A;
    border: 1px solid #404040;
    color: #FFFFFF;
    padding: 12px 16px;
    font-size: 14px;
    border-radius: 6px;
    transition: border-color 0.2s;
    box-sizing: border-box;
    font-family: inherit;
}

.form-input:focus,
.form-select:focus,
.form-textarea:focus {
    outline: none;
    border-color: #00FF85;
}

.form-textarea {
    resize: vertical;
    min-height: 100px;
}

.form-select {
    cursor: pointer;
}

.form-actions {
    display: flex;
    gap: 16px;
    justify-content: flex-end;
    margin-top: 32px;
}

.btn-primary {
    background: linear-gradient(90deg, #00FF85, #00CC6A);
    color: #000000;
    border: none;
    padding: 14px 32px;
    font-size: 14px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    cursor: pointer;
    border-radius: 6px;
    transition: all 0.2s;
}

.btn-primary:hover:not(:disabled) {
    background: linear-gradient(90deg, #00CC6A, #00AA55);
    transform: translateY(-1px);
}

.btn-primary:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

.btn-secondary {
    background: transparent;
    color: #00FF85;
    border: 2px solid #00FF85;
    padding: 12px 32px;
    font-size: 14px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    cursor: pointer;
    border-radius: 6px;
    transition: all 0.2s;
}

.btn-secondary:hover {
    background: #00FF85;
    color: #000000;
}

.loading {
    display: none;
    justify-content: center;
    align-items: center;
    gap: 12px;
    margin-top: 24px;
    color: #B0B0B0;
    font-size: 14px;
}

.loading-spinner {
    width: 20px;
    height: 20px;
    border: 2px solid #333333;
    border-top-color: #00FF85;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

@media (max-width: 768px) {
    .valuation-form-container {
        padding: 16px;
    }
    
    .valuation-form {
        padding: 24px;
    }
    
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .form-actions {
        flex-direction: column;
    }
    
    .btn-primary,
    .btn-secondary {
        width: 100%;
    }
}
</style>

<script>
// Valuation form handler - Centralized
async function handleValuationSubmit(event) {
    event.preventDefault();
    
    const form = document.getElementById('valuationForm');
    const submitBtn = document.getElementById('valuationSubmitBtn');
    const loading = document.getElementById('valuationLoading');
    
    // Show loading state
    submitBtn.disabled = true;
    loading.style.display = 'flex';
    
    // Get form data
    const formData = new FormData(form);
    const valuationData = {
        manufacturer: formData.get('manufacturer'),
        model: formData.get('model'),
        year: parseInt(formData.get('year')),
        capacity_tons: parseFloat(formData.get('capacity')),
        operating_hours: formData.get('hours') ? parseInt(formData.get('hours')) : null,
        condition: formData.get('condition'),
        region: formData.get('region'),
        country: formData.get('country'),
        notes: formData.get('notes')
    };
    
    try {
        const accessToken = safeStorage?.getItem('access_token');
        
        const response = await fetch('/api/v1/valuation/calculate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                ...(accessToken && { 'Authorization': `Bearer ${accessToken}` })
            },
            body: JSON.stringify(valuationData)
        });
        
        const result = await response.json();
        
        if (result.success) {
            // Redirect to results page or show results
            if (typeof notificationSystem !== 'undefined') {
                notificationSystem.showSuccess('Valuation Complete', 'Your valuation has been calculated');
            }
            
            // Store results and redirect
            if (result.data) {
                safeStorage?.setItem('last_valuation', JSON.stringify(result.data));
                window.location.href = '/valuation-results.html';
            }
        } else {
            throw new Error(result.error || 'Valuation calculation failed');
        }
    } catch (error) {
        console.error('Valuation error:', error);
        if (typeof notificationSystem !== 'undefined') {
            notificationSystem.showError('Valuation Failed', error.message || 'Unable to calculate valuation. Please try again.');
        } else {
            alert('Error: ' + (error.message || 'Unable to calculate valuation'));
        }
    } finally {
        submitBtn.disabled = false;
        loading.style.display = 'none';
    }
}

function resetValuationForm() {
    const form = document.getElementById('valuationForm');
    if (form) {
        form.reset();
    }
}

// Initialize form handler when component loads
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('valuationForm');
    if (form) {
        form.addEventListener('submit', handleValuationSubmit);
    }
});
</script>

